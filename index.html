<!doctype html>
<html>
    <head>
        <meta charset="utf-8">
        <title>TinyNote</title>
        <link rel="stylesheet" type="text/css" href="style.css">
    </head>

    <body>
        <ul>
            <li>
                <div class="switch">
                    <span class="save" onclick="saveAlert()">Save</span>
                </div>
            </li>
            <li>
                <div class="switch">
                    <span class="download" onclick="download().innerHTML">Download</span>
                </div>
            </li>
            <li style="float:right">
                <div class="switch">
                    <span class="inner-switch">Light Mode</span>
                </div> 
            </li>
        </ul>
        <br>

        <ul>
            <li id="title">
                <h1 id="tinyNote">TinyNote</h1>
            </li>
            <li>
                <h2 id="author">
                    <a href="https://github.com/agarcia-caicedo" target="_blank">by semortea</a>
                </h2>
            </li>
        </ul>
            
        <div>
            <div id="myNicPanel"></div>
        
            <div id="container">
                <div id="note" contenteditable style="min-height:15px"></div>
            </div>
        </div>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>
        <script src="https://unpkg.com/filer/dist/filer.min.js"></script>
        <script src="http://js.nicedit.com/nicEdit-latest.js"></script>
        <script src="https://cdn.jsdelivr.net/g/filesaver.js"></script>
        <script src= "script.js"></script>
        <script>
            $(".inner-switch").on("click", function () {
                if ($("body").hasClass("light")) {
                    $("body").removeClass("light");
                    $(".inner-switch").text("Light Mode");
                } else {
                    $("body").addClass("light");
                    $(".inner-switch").text("Dark Mode");
                }
            });

            bkLib.onDomLoaded(function () {
                var myNicEditor = new nicEditor({
                    buttonList:
                        ['bold', 'italic', 'underline', 'left', 'center', 'right', 'justify', 'ol', 'ul',
                            'fontFormat', 'fontFamily', 'forecolor', 'subscript', 'superscript', 'strikethrough',
                            'removeformat', 'indent', 'outdent', 'hr']
                });
                myNicEditor.setPanel('myNicPanel');
                myNicEditor.addInstance('note');
            });

            const fs = new Filer.FileSystem();
            window.addEventListener('DOMContentLoaded', (event) => {
                fs.readFile('/note', 'utf8', function (err, data) {
                    if (err) {
                        document.querySelector("#note").innerHTML = "Welcome to my notepad! Start Typing...";
                    }
                    else if (data) {
                        document.querySelector("#note").innerHTML = data;
                    }
                });
            });
            var intervalID = window.setInterval(save, 20000);
            function save(a) {
                fs.writeFile('/note', document.querySelector('#note').innerHTML);
                console.log(a);

            }

            function saveAlert() {
                save();
                alert("Saved!");
            }

            function download() {
                var blob = new Blob([document.querySelector('#note').innerHTML], { type: "text/xml;charset=utf-8" });
                saveAs(blob, "tiny.xml");
            }
        </script>

    </body>
</html>
